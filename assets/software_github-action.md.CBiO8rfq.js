import{_ as a,c as i,o as n,a4 as l}from"./chunks/framework.C2Gk6cJW.js";const c=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"software/github-action.md","filePath":"software/github-action.md","lastUpdated":1755066352000}'),p={name:"software/github-action.md"};function t(e,s,h,k,d,o){return n(),i("div",null,s[0]||(s[0]=[l(`<h2 id="github-action" tabindex="-1">Github Action <a class="header-anchor" href="#github-action" aria-label="Permalink to &quot;Github Action&quot;">​</a></h2><ul><li>소프트웨어 workflow 자동화 도구</li></ul><ol><li>Workflow : 여러개의 Job로 구성되는 프로세스</li><li>Event : Workflow를 실행하는 규칙 (특정시간 반복)</li><li>Job : 여러 Step을 구성해서 실행</li><li>Step : action을 실행 (ssh-action, scp-action 등)</li></ol><h2 id="repository에-github-action-추가" tabindex="-1">Repository에 Github Action 추가 <a class="header-anchor" href="#repository에-github-action-추가" aria-label="Permalink to &quot;Repository에 Github Action 추가&quot;">​</a></h2><ol><li>Github Repository &gt; Actions &gt; Java With Gradle &gt; Configure</li><li>root 폴더에서 /.github/workflows/gradle.yml 생성 &gt; Start commit (기본 생성은 build까지 됨)</li><li>GitAction Flow:</li></ol><ul><li><p>JDK Setup &gt; Build &gt; Upload Jar(upload-artifact) &gt; Kill Service(ssh-action) &gt; Download Jar(download-artifact) &gt; Upload File to Server (scp-action) &gt; Run Jar (ssh-action)</p></li><li><p>JDK Setup</p></li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>    - uses: actions/checkout@v2</span></span>
<span class="line"><span>    - name: Set up JDK 11</span></span>
<span class="line"><span>      uses: actions/setup-java@v2</span></span>
<span class="line"><span>      with:</span></span>
<span class="line"><span>        java-version: &#39;11&#39;</span></span>
<span class="line"><span>        distribution: &#39;adopt&#39;</span></span></code></pre></div><ul><li>Build</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>    - name: Build with Gradle</span></span>
<span class="line"><span>      uses: gradle/gradle-build-action@4137be6a8bf7d7133955359dbd952c0ca73b1021</span></span>
<span class="line"><span>      with:</span></span>
<span class="line"><span>        arguments: build</span></span></code></pre></div><ul><li>Upload Jar(upload-artifact)</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>    - name: Upload Jar</span></span>
<span class="line"><span>      uses: actions/upload-artifact@v2</span></span>
<span class="line"><span>      with:</span></span>
<span class="line"><span>        name: spring-boot</span></span>
<span class="line"><span>        path: build/libs/spring-0.0.1-SNAPSHOT.jar</span></span>
<span class="line"><span>        retention-days: 1</span></span>
<span class="line"><span>    - run: |</span></span>
<span class="line"><span>        rm -f ~/.gradle/caches/modules-2/modules-2.lock</span></span>
<span class="line"><span>        rm -f ~/.gradle/caches/modules-2/gc.properties</span></span>
<span class="line"><span>      name: Cleanup Gradle Cache</span></span></code></pre></div><ul><li>Kill Service(ssh-action)</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>    - uses: appleboy/ssh-action@v0.1.4</span></span>
<span class="line"><span>      name: Kill Spring Boot Application</span></span>
<span class="line"><span>      with:</span></span>
<span class="line"><span>        host: \${{ secrets.SERV_HOST }}</span></span>
<span class="line"><span>        username: \${{ secrets.SERV_USERNAME }}</span></span>
<span class="line"><span>        password: \${{ secrets.SERV_KEY }}</span></span>
<span class="line"><span>        script: |</span></span>
<span class="line"><span>          if [ -e &quot;pid.file&quot; ]; then</span></span>
<span class="line"><span>            kill $(cat ./pid.file)</span></span>
<span class="line"><span>          fi</span></span></code></pre></div><ul><li>Download Jar(download-artifact)</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>      - name: Download Jar</span></span>
<span class="line"><span>        uses: actions/download-artifact@v2</span></span>
<span class="line"><span>        with:</span></span>
<span class="line"><span>          name: spring-boot</span></span></code></pre></div><ul><li>Upload File to Server (scp-action)</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>      - name: SCP Files</span></span>
<span class="line"><span>        uses: appleboy/scp-action@master</span></span>
<span class="line"><span>        with:</span></span>
<span class="line"><span>          host: \${{ secrets.SERV_HOST }}</span></span>
<span class="line"><span>          username: \${{ secrets.SERV_USERNAME }}</span></span>
<span class="line"><span>          password: \${{ secrets.SERV_KEY }}</span></span>
<span class="line"><span>          source: &quot;spring-0.0.1-SNAPSHOT.jar&quot;</span></span>
<span class="line"><span>          target: &quot;build&quot;</span></span>
<span class="line"><span>          rm: true</span></span></code></pre></div><ul><li>Run Jar (ssh-action)</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>      - uses: appleboy/ssh-action@v0.1.4</span></span>
<span class="line"><span>        name: Run the application</span></span>
<span class="line"><span>        with:</span></span>
<span class="line"><span>          host: \${{ secrets.SERV_HOST }}</span></span>
<span class="line"><span>          username: \${{ secrets.SERV_USERNAME }}</span></span>
<span class="line"><span>          password: \${{ secrets.SERV_KEY }}</span></span>
<span class="line"><span>          script: |</span></span>
<span class="line"><span>            nohup java -jar build/spring-0.0.1-SNAPSHOT.jar &gt; app.out 2&gt; app.err &lt; /dev/null &amp;</span></span>
<span class="line"><span>            nohup echo $! &gt; ./pid.file &amp;</span></span></code></pre></div><ol start="4"><li><p>secrets.SERV_HOST 등의 설정은 Github Repository &gt; Settings &gt; Secrets에서 추가 (workflow내에 설정이 가능하지만 보안문제가 있을 수 있음)</p></li><li><p>Github Repository &gt; Settings &gt; Actions &gt; 액션관련 설정 (Artifact and log retention을 7 days 정도로 설정하는 등 )</p></li></ol><h2 id="server-ubuntu-설정" tabindex="-1">Server (Ubuntu) 설정 <a class="header-anchor" href="#server-ubuntu-설정" aria-label="Permalink to &quot;Server (Ubuntu) 설정&quot;">​</a></h2><ol><li>jdk 설치</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> openjdk-11-jdk</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">java</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -version</span></span></code></pre></div><ol start="2"><li>mysql 설치</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt-get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mysql-server</span></span></code></pre></div><ol start="3"><li>외부접속 기능 설정 (3306 port open)</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ufw</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> allow</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mysql</span></span></code></pre></div><ol start="4"><li>mysql 실행</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> start</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mysql</span></span></code></pre></div><ol start="5"><li>서버 재시작시 자동 실행</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enable</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mysql</span></span></code></pre></div><ol start="6"><li>mysql 접속</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/bin/mysql</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -u</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span></span></code></pre></div><ol start="7"><li>비밀번호 설정</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">SET</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> PASSWORD</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> FOR</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;root&#39;@&#39;localhost&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> PASSWORD</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&#39;1234&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ALTER</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> USER</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;root&#39;@&#39;localhost&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> IDENTIFIED</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> WITH</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mysql_native_password</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> BY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;1234&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><ol start="8"><li>mysql schema 추가</li></ol><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>CREATE DATABASE testdb;</span></span></code></pre></div><ol start="9"><li><p>서버에 인바운드 포트 활성화</p></li><li><p>mysql 외부접속 안될 때</p></li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">netstat</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -ntlp</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mysqld</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/bin/mysql</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -u</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mysql</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">show</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> variables</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> like</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;%bind%&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">exit</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/mysql/mysql.conf.d</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> vi</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mysqld.cnf</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">bind-address</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 변경</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 127.0.0.1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> -</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.0.0.0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mysql</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> status</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mysql</span></span></code></pre></div><ol start="11"><li>mysql 제거</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt-get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> remove</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --purge</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mysql</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt-get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> remove</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --purge</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mysql</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dpkg</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -l</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mysql</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt-get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> remove</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --purge</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mysql-apt-config</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -rf</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/mysql</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/lib/mysql</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt-get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> autoremove</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt-get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> autoclean</span></span></code></pre></div>`,41)]))}const F=a(p,[["render",t]]);export{c as __pageData,F as default};
