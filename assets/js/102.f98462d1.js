(window.webpackJsonp=window.webpackJsonp||[]).push([[102],{398:function(s,a,t){"use strict";t.r(a);var e=t(4),n=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"github-action"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#github-action"}},[s._v("#")]),s._v(" Github Action")]),s._v(" "),a("ul",[a("li",[s._v("소프트웨어 workflow 자동화 도구")])]),s._v(" "),a("ol",[a("li",[s._v("Workflow : 여러개의 Job로 구성되는 프로세스")]),s._v(" "),a("li",[s._v("Event : Workflow를 실행하는 규칙 (특정시간 반복)")]),s._v(" "),a("li",[s._v("Job : 여러 Step을 구성해서 실행")]),s._v(" "),a("li",[s._v("Step : action을 실행 (ssh-action, scp-action 등)")])]),s._v(" "),a("h2",{attrs:{id:"repository에-github-action-추가"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#repository에-github-action-추가"}},[s._v("#")]),s._v(" Repository에 Github Action 추가")]),s._v(" "),a("ol",[a("li",[s._v("Github Repository > Actions > Java With Gradle > Configure")]),s._v(" "),a("li",[s._v("root 폴더에서 /.github/workflows/gradle.yml 생성 > Start commit\n(기본 생성은 build까지 됨)")]),s._v(" "),a("li",[s._v("GitAction Flow:")])]),s._v(" "),a("ul",[a("li",[a("p",[s._v("JDK Setup > Build > Upload Jar(upload-artifact) > Kill Service(ssh-action) > Download Jar(download-artifact) > Upload File to Server (scp-action) > Run Jar (ssh-action)")])]),s._v(" "),a("li",[a("p",[s._v("JDK Setup")])])]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("    - uses: actions/checkout@v2\n    - name: Set up JDK 11\n      uses: actions/setup-java@v2\n      with:\n        java-version: '11'\n        distribution: 'adopt'\n")])])]),a("ul",[a("li",[s._v("Build")])]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("    - name: Build with Gradle\n      uses: gradle/gradle-build-action@4137be6a8bf7d7133955359dbd952c0ca73b1021\n      with:\n        arguments: build\n")])])]),a("ul",[a("li",[s._v("Upload Jar(upload-artifact)")])]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("    - name: Upload Jar\n      uses: actions/upload-artifact@v2\n      with:\n        name: spring-boot\n        path: build/libs/spring-0.0.1-SNAPSHOT.jar\n        retention-days: 1\n    - run: |\n        rm -f ~/.gradle/caches/modules-2/modules-2.lock\n        rm -f ~/.gradle/caches/modules-2/gc.properties\n      name: Cleanup Gradle Cache\n")])])]),a("ul",[a("li",[s._v("Kill Service(ssh-action)")])]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('    - uses: appleboy/ssh-action@v0.1.4\n      name: Kill Spring Boot Application\n      with:\n        host: ${{ secrets.SERV_HOST }}\n        username: ${{ secrets.SERV_USERNAME }}\n        password: ${{ secrets.SERV_KEY }}\n        script: |\n          if [ -e "pid.file" ]; then\n            kill $(cat ./pid.file)\n          fi\n')])])]),a("ul",[a("li",[s._v("Download Jar(download-artifact)")])]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("      - name: Download Jar\n        uses: actions/download-artifact@v2\n        with:\n          name: spring-boot\n")])])]),a("ul",[a("li",[s._v("Upload File to Server (scp-action)")])]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('      - name: SCP Files\n        uses: appleboy/scp-action@master\n        with:\n          host: ${{ secrets.SERV_HOST }}\n          username: ${{ secrets.SERV_USERNAME }}\n          password: ${{ secrets.SERV_KEY }}\n          source: "spring-0.0.1-SNAPSHOT.jar"\n          target: "build"\n          rm: true\n')])])]),a("ul",[a("li",[s._v("Run Jar (ssh-action)")])]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("      - uses: appleboy/ssh-action@v0.1.4\n        name: Run the application\n        with:\n          host: ${{ secrets.SERV_HOST }}\n          username: ${{ secrets.SERV_USERNAME }}\n          password: ${{ secrets.SERV_KEY }}\n          script: |\n            nohup java -jar build/spring-0.0.1-SNAPSHOT.jar > app.out 2> app.err < /dev/null &\n            nohup echo $! > ./pid.file &\n\n")])])]),a("ol",{attrs:{start:"4"}},[a("li",[a("p",[s._v("secrets.SERV_HOST 등의 설정은 Github Repository > Settings > Secrets에서 추가 (workflow내에 설정이 가능하지만 보안문제가 있을 수 있음)")])]),s._v(" "),a("li",[a("p",[s._v("Github Repository > Settings > Actions > 액션관련 설정 (Artifact and log retention을 7 days 정도로 설정하는 등 )")])])]),s._v(" "),a("h2",{attrs:{id:"server-ubuntu-설정"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#server-ubuntu-설정"}},[s._v("#")]),s._v(" Server (Ubuntu) 설정")]),s._v(" "),a("ol",[a("li",[s._v("jdk 설치")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" openjdk-11-jdk\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("java")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-version")]),s._v("\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("mysql 설치")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" mysql-server\n")])])]),a("ol",{attrs:{start:"3"}},[a("li",[s._v("외부접속 기능 설정 (3306 port open)")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" ufw allow mysql\n")])])]),a("ol",{attrs:{start:"4"}},[a("li",[s._v("mysql 실행")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl start mysql\n")])])]),a("ol",{attrs:{start:"5"}},[a("li",[s._v("서버 재시작시 자동 실행")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" mysql\n")])])]),a("ol",{attrs:{start:"6"}},[a("li",[s._v("mysql 접속")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" /usr/bin/mysql "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" root "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v("\n")])])]),a("ol",{attrs:{start:"7"}},[a("li",[s._v("비밀번호 설정")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("SET PASSWORD FOR "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'root'")]),s._v("@"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" PASSWORD"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1234'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nALTER "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'root'")]),s._v("@"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost'")]),s._v(" IDENTIFIED WITH mysql_native_password BY "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1234'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("ol",{attrs:{start:"8"}},[a("li",[s._v("mysql schema 추가")])]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("CREATE DATABASE testdb;\n")])])]),a("ol",{attrs:{start:"9"}},[a("li",[a("p",[s._v("서버에 인바운드 포트 활성화")])]),s._v(" "),a("li",[a("p",[s._v("mysql 외부접속 안될 때")])])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("netstat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-ntlp")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" mysqld\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" /usr/bin/mysql "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" root "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v("\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" show variables like "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%bind%'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /etc/mysql/mysql.conf.d\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" mysqld.cnf\nbind-address 변경 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 -"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0\nsystemctl restart mysql\nsystemctl status mysql\n")])])]),a("ol",{attrs:{start:"11"}},[a("li",[s._v("mysql 제거")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" remove "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--purge")]),s._v(" mysql\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" remove "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--purge")]),s._v(" mysql*\ndpkg "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" mysql\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" remove "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--purge")]),s._v(" mysql-apt-config\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-rf")]),s._v(" /etc/mysql /var/lib/mysql\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" autoremove\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" autoclean\n")])])])])}),[],!1,null,null,null);a.default=n.exports}}]);